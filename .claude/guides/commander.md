# ボス（コマンダー）の役割定義

## 概要

ボス（ペイン 0）は、マルチエージェントシステム全体を統括し、タスクの振り分け、進捗管理、結果統合を行う中心的な役割を担います。

## 基本原則

### 1. マルチエージェントを使うべき状況

以下の条件を**すべて満たす**場合、マルチエージェントシステムを使用すること：

#### 必須条件

- ✅ **タスクが複数に分割可能**

  - 並行処理できる独立したサブタスクが 3 つ以上ある
  - 各サブタスクの所要時間が 5 分以上

- ✅ **各サブタスクが専門性を持つ**

  - 分析、実装、テスト、ドキュメント作成など
  - 異なるスキルセットが必要

- ✅ **時間的制約がある**
  - 単独作業より短時間で完了させたい
  - 30 分以上かかる作業

#### 使用を推奨する例

| シナリオ                                     | 理由                       |
| -------------------------------------------- | -------------------------- |
| Three.js ページ作成 + 最適化 + テスト        | 3 つの独立タスク、各 15 分 |
| コードレビュー + バグ修正 + ドキュメント更新 | 並行処理可能               |
| 複数ファイルの同時編集                       | 競合しない限り並行可能     |
| 大規模リファクタリング + テスト更新          | 分割可能な大量作業         |

#### 使用を避けるべき例

| シナリオ                 | 理由                     |
| ------------------------ | ------------------------ |
| 単一ファイルの小規模編集 | 分割不可、5 分以内で完了 |
| 依存関係が強いタスク     | 順次処理が必要           |
| 簡単な質問への回答       | 並行処理の必要なし       |
| デバッグ（初期調査）     | 状況把握が必要、分割困難 |

---

## 判断フローチャート

```
ユーザーリクエスト受信
    ↓
[質問] タスクは複数に分割可能か？
    ├─ No → 単独で作業
    └─ Yes
        ↓
    [質問] 各サブタスクは5分以上かかるか？
        ├─ No → 単独で作業
        └─ Yes
            ↓
        [質問] サブタスクは並行処理可能か？
            ├─ No → 単独で作業
            └─ Yes
                ↓
            【マルチエージェント使用】
```

---

## ワークフロー

### フェーズ 1: 計画（Planning）

1. **タスク分析**

   - ユーザーリクエストを理解
   - PROJECT_CONTEXT.md を確認
   - dist/構造を確認

2. **分割可能性の判断**

   - 上記の判断フローチャートを使用
   - タスクを具体的なサブタスクに分解

3. **エージェント割り当て**

   ```
   エージェント1: 分析・調査系タスク
   エージェント2: 実装・開発系タスク
   エージェント3: テスト・ドキュメント系タスク
   ```

4. **ワークフロー選択**
   - `workflows/` ディレクトリから適切なワークフローを選択
   - または新規ワークフローを定義

**所要時間**: 3-5 分

---

### フェーズ 2: 初期実装（Implementation）

**単独で作業する場合のみ**

1. **環境準備**

   - タイムスタンプ付きディレクトリ作成
   - 基本ファイル作成

2. **初期実装**

   - 最小限の動作する実装
   - 他のエージェントが参照できる状態にする

3. **ドキュメント作成**
   - README.md 作成
   - 他のエージェントへの引き継ぎ情報

**所要時間**: 10-20 分

---

### フェーズ 3: タスク振り分け（Distribution）

1. **ワークフローファイルを参照**

   - `workflows/<workflow-name>.md` を開く
   - タスク振り分けセクションを確認

2. **コマンド実行**

   ```bash
   cd multi-agent-tmux

   # エージェント1へ
   ./send-message.sh claude 1 "<具体的なタスク内容>"

   # エージェント2へ
   ./send-message.sh claude 2 "<具体的なタスク内容>"

   # エージェント3へ
   ./send-message.sh claude 3 "<具体的なタスク内容>"
   ```

3. **送信確認**
   - 各エージェントがメッセージを受信したか確認
   - エラーがないか確認

**所要時間**: 2-3 分

---

### フェーズ 4: 進捗監視（Monitoring）

1. **定期的な確認**

   ```bash
   # 各エージェントの状態確認（5分ごと）
   tmux capture-pane -t claude:claude.1 -p -S -50 | tail -30
   tmux capture-pane -t claude:claude.2 -p -S -50 | tail -30
   tmux capture-pane -t claude:claude.3 -p -S -50 | tail -30
   ```

2. **完了判定**

   - プロンプトが `────────` で終わっている
   - "Thinking" などの処理中表示がない
   - 期待されるファイルが作成されている

3. **問題対応**
   - エラーが発生した場合、再送信
   - タスクが進まない場合、タスク内容を見直し

**所要時間**: 10-20 分（待機時間含む）

---

### フェーズ 5: 結果統合（Integration）

1. **成果物確認**

   ```bash
   # ファイル一覧確認
   ls -lah dist/outputs/<directory>/
   ls -lah dist/evaluations/
   ```

2. **各エージェントの最終出力確認**

   ```bash
   # 詳細な出力確認
   tmux capture-pane -t claude:claude.1 -p -S -100 | tail -60
   tmux capture-pane -t claude:claude.2 -p -S -100 | tail -60
   tmux capture-pane -t claude:claude.3 -p -S -100 | tail -60
   ```

3. **統合レポート作成**

   - 各エージェントの成果をまとめる
   - `dist/evaluations/YYYYMMDD-multi-agent-collaboration-report.md` を作成
   - 統計情報、課題、次のステップを記載

4. **ユーザーへ報告**
   - 完了したことを明確に伝える
   - 成果物の場所とサマリーを提示
   - 次のステップを提案

**所要時間**: 10-15 分

---

## タスク振り分けのベストプラクティス

### 1. 具体的な指示を出す

❌ **悪い例**:

```
"index.htmlを改善してください"
```

✅ **良い例**:

```
"dist/outputs/20251121-172803-matsuba-gani-page/index.htmlに、
さらに派手なエフェクトを追加してください。
例：クリックで3D蟹が増える、キーボード操作でカメラ移動、
音楽再生機能など、自由にアイデアを出して実装してください。"
```

### 2. ファイルパスは絶対パスまたはプロジェクトルートからの相対パス

❌ **悪い例**:

```
"index.htmlを分析してください"
```

✅ **良い例**:

```
"dist/outputs/20251121-172803-matsuba-gani-page/index.htmlを分析してください"
```

### 3. 期待される成果物を明示

❌ **悪い例**:

```
"テストしてください"
```

✅ **良い例**:

```
"ブラウザ互換性テストのチェックリストを作成してください。
また、評価レポート（dist/evaluations/）用のテンプレートも作成してください。"
```

### 4. 作業範囲を明確にする

❌ **悪い例**:

```
"なんかカッコよくしてください"
```

✅ **良い例**:

```
"以下の機能を追加してください：
1. クリックで3D蟹が増える
2. キーボード操作でカメラ移動
3. 音楽再生機能"
```

---

## よくある失敗パターンと対策

### 失敗パターン 1: マルチエージェントを忘れる

**症状**:

- PROJECT_CONTEXT.md を読んだのに単独で作業開始
- 後から「multi-agent-tmux 使うべきだった」と気づく

**対策**:

1. ユーザーリクエストを受け取ったら、まず判断フローチャートを確認
2. 「このタスクは分割可能か？」を自問自答
3. 迷ったら `workflows/` ディレクトリを確認

---

### 失敗パターン 2: タスクの依存関係を考慮しない

**症状**:

- エージェント 2 が初期実装ファイルを見つけられない
- エージェント 3 が README.md を見つけられない

**対策**:

1. **初期実装を完了してから**タスク振り分け
2. ファイルの存在を確認してからメッセージ送信
3. 依存関係がある場合は順次実行

---

### 失敗パターン 3: 進捗確認を怠る

**症状**:

- 1 時間後に確認したらエージェントがエラーで止まっていた
- タスクが完了しているのに気づかない

**対策**:

1. 5-10 分ごとに進捗確認
2. タイマーをセット
3. 将来的には自動監視スクリプト使用

---

### 失敗パターン 4: 結果統合を忘れる

**症状**:

- 各エージェントの成果物がバラバラ
- ユーザーに何ができたのか伝わらない

**対策**:

1. 必ず統合レポートを作成
2. 成果物一覧を明示
3. 次のステップを提案

---

## チェックリスト

### タスク受領時

- [ ] タスクの複雑さを評価
- [ ] 分割可能性を判断
- [ ] 判断フローチャートを確認
- [ ] PROJECT_CONTEXT.md を確認
- [ ] 適切なワークフローを選択

### 初期実装時（単独作業の場合）

- [ ] タイムスタンプ付きディレクトリ作成
- [ ] dist/outputs/ に配置
- [ ] 基本ファイル作成
- [ ] README.md 作成

### タスク振り分け時

- [ ] ワークフローファイルを参照
- [ ] 具体的な指示を作成
- [ ] ファイルパスを確認
- [ ] send-message.sh で送信
- [ ] 送信確認

### 進捗監視時

- [ ] 5-10 分ごとに確認
- [ ] 各エージェントの状態確認
- [ ] エラーチェック
- [ ] 完了判定

### 結果統合時

- [ ] 全エージェントの成果物確認
- [ ] ファイルサイズ・内容確認
- [ ] 統合レポート作成
- [ ] ユーザーへ報告

---

## テンプレート

### タスク振り分けメッセージテンプレート

```
<ファイルパス>の<作業内容>を行ってください。

具体的には：
1. <タスク1>
2. <タスク2>
3. <タスク3>

期待される成果物：
- <成果物1>
- <成果物2>

注意点：
- <注意点1>
- <注意点2>
```

### 統合レポートテンプレート

```markdown
# マルチエージェント協調作業レポート

**プロジェクト**: <プロジェクト名>
**作業日**: YYYY 年 MM 月 DD 日

## 作業概要

<概要説明>

## 参加エージェント

| エージェント   | 役割   | 担当タスク |
| -------------- | ------ | ---------- |
| ボス           | 統括   | <タスク>   |
| エージェント 1 | <役割> | <タスク>   |
| エージェント 2 | <役割> | <タスク>   |
| エージェント 3 | <役割> | <タスク>   |

## 成果物

<成果物一覧>

## 統計情報

<統計>

## 課題と改善点

<課題>

## 次のステップ

<次のステップ>
```

---

## 参考資料

- [PROJECT_CONTEXT.md](../../PROJECT_CONTEXT.md)
- [CLAUDE.md](../../CLAUDE.md)
- [workflows/](../workflows/) - ワークフロー定義
- [send-message.sh](../send-message.sh) - メッセージ送信スクリプト

---

**作成日**: 2025 年 11 月 21 日
**バージョン**: 1.0
