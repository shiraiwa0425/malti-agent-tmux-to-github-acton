# Multi-Agent Tmux

tmux で複数のペインを管理し、Claude/Codex/Gemini などの AI エージェントを協調動作させるマルチエージェントシステムです。

> 作業開始前に、親リポジトリの `PROJECT_CONTEXT.md` にある「必読ファイル」セクションを確認してください。

## クイックスタート

### シングルセッション（Claude のみ）

```bash
./setup.sh
```

### マルチセッション（Claude + Codex + Gemini）

```bash
# 1. 起動（対話的に選択）
./start-agents.sh

# 起動するセッションを選択してください:
#   1) Claude のみ
#   2) Codex のみ
#   3) Gemini のみ
#   4) 全部 (Claude + Codex + Gemini)
#   5) キャンセル

# 2. セッションに接続
tmux attach -t claude

# 3. セッション切り替え（tmux内）
#    Ctrl-b s    セッション一覧
#    Ctrl-b )    次のセッション
```

## セットアップ

### 基本セットアップ（単一セッション）

```bash
chmod +x setup.sh
./setup.sh [セッション名]
```

**オプション:**
- `./setup.sh` - Claude セッションを作成（デフォルト）
- `./setup.sh codex` - Codex セッションを作成
- `./setup.sh gemini` - Gemini セッションを作成
- `./setup.sh -y claude` - 作成後自動でアタッチ

このスクリプトは以下を実行します：

1. 指定した名前（デフォルト: `claude`）の tmux セッションを作成
2. 同名のウィンドウを作成
3. 4 つのペインを左右に均等分割して作成（マルチエージェント構成）
   - **ペイン 0: ボス (Command Center)**
     - ユーザーの命令を受け取り、タスクを振り分けます
   - **ペイン 1: エージェント 1 (Agent 1)**
     - ボスから割り当てられたタスクを実行します
   - **ペイン 2: エージェント 2 (Agent 2)**
     - ボスから割り当てられたタスクを実行します
   - **ペイン 3: エージェント 3 (Agent 3)**
     - ボスから割り当てられたタスクを実行します
4. 各ペインで対応する AI ツール（claude/codex）を起動

## 手動でセッションを作成する場合

```bash
# セッションを作成
tmux new-session -s claude -n claude

# セッション内でペインを分割
# Ctrl+b の後に % で縦分割（左右）、" で横分割（上下）
# または、以下のコマンドで自動的に3つのペインを作成：

# 1. 縦に分割（左右）
tmux split-window -h

# 2. 右側のペインをさらに縦に分割
tmux split-window -h -t 1

# 3. 左右均等レイアウトに調整
tmux select-layout even-horizontal
```

## 便利な tmux コマンド

- `tmux attach -t claude`: セッションに再接続
- `tmux list-sessions`: すべてのセッションを一覧表示
- `tmux kill-session -t claude`: セッションを終了

## ペイン操作（セッション内）

- `Ctrl+b %`: ペインを縦に分割（左右）
- `Ctrl+b "`: ペインを横に分割（上下）
- `Ctrl+b 矢印キー`: ペイン間を移動
- `Ctrl+b x`: 現在のペインを閉じる
- `Ctrl+b o`: 次のペインに移動
- `Ctrl+b q`: ペイン番号を表示

## Claude 共有セッションの注意事項

> **重要**: このセッションは共有用途です。以下の点に注意してください：

1. **認証情報の取り扱い**

   - 個人の認証情報（API キー、パスワードなど）は使用しないでください
   - 環境変数に機密情報を設定しないでください

2. **セッションの共有**

   - 複数のユーザーが同じセッションに接続できます
   - すべての操作が共有されるため、注意して使用してください

3. **個人用セッションとの使い分け**
   - 認証が必要な作業は個人用セッションで行ってください
   - 共有セッションは、認証が不要な作業のみに使用してください

## セッション構造

### シングルセッション

```
セッション: claude
  └─ ウィンドウ: claude
      ├─ ペイン 0: ボス（タスク振り分け）
      ├─ ペイン 1: エージェント1（タスク実行）
      ├─ ペイン 2: エージェント2（タスク実行）
      └─ ペイン 3: エージェント3（タスク実行）
```

### マルチセッション

```
┌────────────────────────────┬────────────────────────────┬────────────────────────────┐
│    セッション: claude       │    セッション: codex        │    セッション: gemini       │
├──────┬──────┬──────┬──────┼──────┬──────┬──────┬──────┼──────┬──────┬──────┬──────┤
│ボス  │Ag1   │Ag2   │Ag3   │ボス  │Ag1   │Ag2   │Ag3   │ボス  │Ag1   │Ag2   │Ag3   │
└──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┘
                                                │
                                                ▼
                                        dist/outputs/
                                        （すべての成果物）
```

## マルチエージェント構成の動作フロー

1. **ユーザー**がペイン 0（ボス）に命令を入力
2. **ボス**が命令を分析し、タスクをペイン 1〜3 に振り分け
3. **エージェント 1〜3**がそれぞれ割り当てられたタスクを並行実行
4. 各エージェントが結果をボスに報告
5. ボスが結果を統合してユーザーに提示

## スクリプト一覧

| スクリプト | 説明 |
|-----------|------|
| `setup.sh` | tmuxセッションを作成 |
| `send-message.sh` | エージェントにメッセージ送信 |
| `start-agents.sh` | マルチエージェントを起動 |
| `orchestrate.sh` | ワークフローを自動実行 |
| `clear-flags.sh` | 完了フラグをクリア |

## ドキュメント

- [USAGE.md](USAGE.md) - 詳細な使用ガイド
- [docs/message-sending-design.md](docs/message-sending-design.md) - 技術設計書
